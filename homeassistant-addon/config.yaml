name: Wombatt
version: 0.2.1
slug: wombatt
description: Monitor inverters and batteries
arch:
  - aarch64
  - amd64
  - armv7
url: https://github.com/gonzalop/wombatt
startup: application
boot: auto
options:
  mode: inverters  # Operation mode: 'inverters' or 'batteries'

  # Common options (apply to both modes)
  common:
    log_level: info  # Log level: debug, info, warn, or error
    mqtt_broker: ""  # MQTT broker address (e.g., tcp://192.168.1.100:1883)
    mqtt_user: ""  # MQTT username (optional)
    mqtt_password: ""  # MQTT password (optional)
    mqtt_topic_prefix: homeassistant  # Prefix for MQTT topics

  # Inverter monitoring configuration (used when mode=inverters)
  inverters:
    baud_rate: 2400  # Baud rate for serial communication
    data_bits: 8  # Data bits for serial communication
    stop_bits: 1  # Stop bits for serial communication
    parity: N  # Parity: N (none), E (even), or O (odd)
    modbus_id: 1  # Modbus slave ID
    monitors: ""  # Comma-separated list of monitors (e.g., /dev/ttyUSB0,QPIRI,inverter1)
    protocol: auto  # Protocol: auto, ModbusRTU, or ModbusTCP
    poll_interval: 10s  # Time between polling cycles (e.g., 10s, 1m)
    read_timeout: 5s  # Timeout when reading from devices
    web_server_address: ""  # Web server address (e.g., :8080) for metrics
    device_type: serial  # Device type: serial, hidraw, or tcp

  # Battery monitoring configuration (used when mode=batteries)
  batteries:
    address: "/dev/ttyUSB0"  # Device address (serial port or IP:port)
    baud_rate: 9600  # Baud rate for serial communication
    bms_type: EG4LLv2  # BMS type: EG4LLv2, lifepower4, lifepowerv2, or pacemodbus
    mqtt_prefix: eg4  # Prefix for MQTT topics (defaults to 'eg4')
    battery_ids: ""  # Comma-separated list of battery IDs (e.g., 1,2,3)
    protocol: auto  # Protocol: auto, lifepower4, lifepowerv2, or pacemodbus
    poll_interval: 10s  # Time between polling cycles (e.g., 10s, 1m)
    read_timeout: 500ms  # Timeout when reading from devices
    web_server_address: ""  # Web server address (e.g., :8080) for metrics
    device_type: serial  # Device type: serial, hidraw, or tcp
schema:
  mode: "list(inverters|batteries)"
  common:
    log_level: "list(debug|info|warn|error)?"
    mqtt_broker: "str?"
    mqtt_user: "str?"
    mqtt_password: "str?"
    mqtt_topic_prefix: "str?"
  inverters:
    baud_rate: "int?"
    data_bits: "int?"
    stop_bits: "int?"
    parity: "list(N|E|O)?"
    modbus_id: "int?"
    monitors: "str?"
    protocol: "list(auto|ModbusRTU|ModbusTCP)?"
    poll_interval: "str?"
    read_timeout: "str?"
    web_server_address: "str?"
    device_type: "list(serial|hidraw|tcp)?"
  batteries:
    address: "str?"
    baud_rate: "int?"
    bms_type: "list(EG4LLv2|lifepower4|lifepowerv2|pacemodbus)?"
    mqtt_prefix: "str?"
    battery_ids: "str?"
    protocol: "list(auto|lifepower4|lifepowerv2|pacemodbus)?"
    poll_interval: "str?"
    read_timeout: "str?"
    web_server_address: "str?"
    device_type: "list(serial|hidraw|tcp)?"
ports:
  8080/tcp: null
ports_description:
  8080/tcp: Web interface (if enabled)
host_network: true
privileged:
  - SYS_RAWIO
devices:
  - /dev/ttyUSB0:/dev/ttyUSB0:rwm
